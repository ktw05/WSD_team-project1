<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.wsd_final_team_project.dao.BirthdayPostDAO">


<!-- 게시글 작성 -->
    <insert id="insertPost" parameterType="BirthdayPostVO">
        INSERT INTO BirthdayPost (
        user_id,
        group_name,
        birthday_date,
        birthday_img_url,
        birthday_person_name,
        celebration_text,
        view_count,
        created_at
        )
        VALUES (
        #{userId},
        #{groupName},
        #{birthdayDate},
        #{birthdayImgUrl},
        #{birthdayPersonName},
        #{celebrationText},
        0,
        NOW()
        )
    </insert>

    <!-- 게시글 삭제 -->
    <delete id="deletePost" parameterType="int">
        DELETE FROM BirthdayPost
        WHERE id = #{id}
    </delete>

    <!-- 게시글 수정 -->
    <update id="updatePost" parameterType="BirthdayPostVO">
        UPDATE BirthdayPost
        SET
        group_name = #{groupName},
        birthday_date = #{birthdayDate},
        birthday_img_url = #{birthdayImgUrl},
        birthday_person_name = #{birthdayPersonName},
        celebration_text = #{celebrationText}
        WHERE id = #{id}
    </update>

    <!-- ✅ 작성자만 빠르게 확인용 -->
    <select id="getPostOwnerId" parameterType="int" resultType="int">
        SELECT user_id
        FROM BirthdayPost
        WHERE id = #{id}
    </select>

    <!-- 게시글 하나 상세 보기 -->
    <select id="getPost" parameterType="int" resultType="BirthdayPostVO">
        SELECT
        id,
        user_id AS userId,
        group_name AS groupName,
        birthday_date AS birthdayDate,
        birthday_img_url AS birthdayImgUrl,
        birthday_person_name AS birthdayPersonName,
        celebration_text AS celebrationText,
        view_count AS viewCount,
        created_at AS createdAt
        FROM BirthdayPost
        WHERE id = #{id}
    </select>

    <!-- 전체 게시글 목록 -->
    <select id="getPostList" resultType="BirthdayPostVO">
        SELECT
        id,
        user_id AS userId,
        group_name AS groupName,
        birthday_date AS birthdayDate,
        birthday_img_url AS birthdayImgUrl,
        birthday_person_name AS birthdayPersonName,
        celebration_text AS celebrationText,
        view_count AS viewCount,
        created_at AS createdAt
        FROM BirthdayPost
        ORDER BY id DESC
    </select>

    <!-- 조회수 증가 -->
    <update id="increaseViewCount" parameterType="int">
        UPDATE BirthdayPost
        SET view_count = view_count + 1
        WHERE id = #{id}
    </update>

    <!-- 검색 -->
    <select id="searchPosts" parameterType="string" resultType="BirthdayPostVO">
        SELECT
        id,
        user_id AS userId,
        group_name AS groupName,
        birthday_date AS birthdayDate,
        birthday_img_url AS birthdayImgUrl,
        birthday_person_name AS birthdayPersonName,
        celebration_text AS celebrationText,
        view_count AS viewCount,
        created_at AS createdAt
        FROM BirthdayPost
        WHERE
        group_name LIKE CONCAT('%', #{keyword}, '%')
        OR birthday_person_name LIKE CONCAT('%', #{keyword}, '%')
        OR celebration_text LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY id DESC
    </select>

</mapper>
